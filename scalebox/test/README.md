# ScaleBox Sandbox éªŒè¯æµ‹è¯•å¥—ä»¶

è¿™ä¸ªæµ‹è¯•å¥—ä»¶åŒ…å«äº†é’ˆå¯¹ `sandbox_async` å’Œ `sandbox_sync` æ¨¡å—çš„å…¨é¢éªŒè¯ç¤ºä¾‹ï¼Œæ¶µç›–äº†ä»ŽåŸºæœ¬åŠŸèƒ½åˆ°é«˜çº§ä½¿ç”¨åœºæ™¯çš„å„ä¸ªæ–¹é¢ã€‚

## ðŸ“‹ æµ‹è¯•æ–‡ä»¶æ¦‚è§ˆ

### 1. åŸºç¡€åŠŸèƒ½éªŒè¯

#### `test_sandbox_async_comprehensive.py`
**å¼‚æ­¥æ²™ç®±ç»¼åˆéªŒè¯æµ‹è¯•**
- âœ… æ²™ç®±ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ˆåˆ›å»ºã€è¿žæŽ¥ã€é”€æ¯ï¼‰
- âœ… æ–‡ä»¶ç³»ç»Ÿæ“ä½œï¼ˆè¯»å†™ã€åˆ—è¡¨ã€åˆ é™¤ã€é‡å‘½åç­‰ï¼‰
- âœ… å‘½ä»¤æ‰§è¡Œï¼ˆå‰å°ã€åŽå°ã€PTYï¼‰
- âœ… é™æ€æ–¹æ³•å’Œç±»æ–¹æ³•
- âœ… é”™è¯¯å¤„ç†å’Œå¼‚å¸¸æƒ…å†µ
- âœ… æ€§èƒ½æµ‹è¯•å’Œå¹¶å‘æ“ä½œ
- âœ… ä¸Šä¸‹æ–‡ç®¡ç†å™¨ä½¿ç”¨

**è¿è¡Œæ–¹å¼ï¼š**
```bash
cd /home/ubuntu/git_home/scalebox/test
python test_sandbox_async_comprehensive.py
```

#### `test_sandbox_sync_comprehensive.py`
**åŒæ­¥æ²™ç®±ç»¼åˆéªŒè¯æµ‹è¯•**
- âœ… ä¸Žå¼‚æ­¥ç‰ˆæœ¬ç›¸åŒçš„åŠŸèƒ½è¦†ç›–
- âœ… åŒæ­¥ç‰¹å®šçš„æ“ä½œæ¨¡å¼
- âœ… çº¿ç¨‹æ± å¹¶å‘å¤„ç†
- âœ… ç›®å½•ç›‘æŽ§åŠŸèƒ½

**è¿è¡Œæ–¹å¼ï¼š**
```bash
cd /home/ubuntu/git_home/scalebox/test
python test_sandbox_sync_comprehensive.py
```

### 2. åŽ‹åŠ›æµ‹è¯•å’Œè¾¹ç•Œæ¡ä»¶

#### `test_sandbox_stress_and_edge_cases.py`
**åŽ‹åŠ›æµ‹è¯•å’Œè¾¹ç•Œæ¡ä»¶éªŒè¯**
- ðŸ”¥ å¤§æ•°æ®æ–‡ä»¶å¤„ç†ï¼ˆ10MB+ æ–‡ä»¶ï¼‰
- ðŸ”¥ é«˜å¹¶å‘æ“ä½œï¼ˆåŒæ­¥å’Œå¼‚æ­¥ï¼‰
- ðŸ”¥ å†…å­˜åŽ‹åŠ›æµ‹è¯•ï¼ˆ1000+ æ–‡ä»¶æ“ä½œï¼‰
- ðŸ”¥ è¾¹ç•Œæ¡ä»¶æµ‹è¯•ï¼ˆç©ºæ–‡ä»¶ã€ç‰¹æ®Šå­—ç¬¦ã€æ·±å±‚ç›®å½•ï¼‰
- ðŸ”¥ é”™è¯¯æ¢å¤èƒ½åŠ›æµ‹è¯•
- ðŸ”¥ èµ„æºç®¡ç†æµ‹è¯•ï¼ˆå¤šæ²™ç®±å®žä¾‹ï¼‰

**è¿è¡Œæ–¹å¼ï¼š**
```bash
cd /home/ubuntu/git_home/scalebox/test
python test_sandbox_stress_and_edge_cases.py
```

### 3. å®žé™…åº”ç”¨ç¤ºä¾‹

#### `test_sandbox_usage_examples.py`
**ä½¿ç”¨ç¤ºä¾‹å’Œæœ€ä½³å®žè·µ**
- ðŸ’¡ ä»£ç æ‰§è¡ŒæœåŠ¡å®žçŽ°
- ðŸ’¡ æ–‡ä»¶å¤„ç†æœåŠ¡å®žçŽ°
- ðŸ’¡ äº¤äº’å¼ä¼šè¯ç®¡ç†
- ðŸ’¡ æ€§èƒ½ä¼˜åŒ–æŠ€å·§
- ðŸ’¡ èµ„æºç®¡ç†æœ€ä½³å®žè·µ
- ðŸ’¡ é”™è¯¯å¤„ç†ç­–ç•¥
- ðŸ’¡ å¹¶å‘å’Œå¼‚æ­¥ç¼–ç¨‹æ¨¡å¼

**è¿è¡Œæ–¹å¼ï¼š**
```bash
cd /home/ubuntu/git_home/scalebox/test
python test_sandbox_usage_examples.py
```

## ðŸ—ï¸ æµ‹è¯•æž¶æž„è®¾è®¡

### æµ‹è¯•ç»“æžœè®°å½•ç³»ç»Ÿ
æ¯ä¸ªæµ‹è¯•å¥—ä»¶éƒ½åŒ…å«å®Œæ•´çš„æµ‹è¯•ç»“æžœè®°å½•ç³»ç»Ÿï¼š
```python
class TestValidator:
    def log_test_result(self, test_name: str, success: bool, message: str = "", duration: float = 0)
    def run_test(self, test_func, test_name: str)
    def print_summary(self)
```

### èµ„æºç®¡ç†ç³»ç»Ÿ
æ™ºèƒ½çš„æ²™ç®±èµ„æºç®¡ç†ï¼š
```python
class SandboxManager:
    @contextmanager
    def get_sandbox(self, sandbox_id: Optional[str] = None)

class AsyncSandboxManager:
    @asynccontextmanager
    async def get_sandbox(self, sandbox_id: Optional[str] = None)
```

### é‡è¯•æœºåˆ¶
å†…ç½®çš„é‡è¯•è£…é¥°å™¨ï¼š
```python
@retry_on_failure(max_retries=3, delay=1.0)
def your_function():
    # è‡ªåŠ¨é‡è¯•å¤±è´¥çš„æ“ä½œ
    pass

@async_retry_on_failure(max_retries=3, delay=1.0)
async def your_async_function():
    # å¼‚æ­¥é‡è¯•æœºåˆ¶
    pass
```

## ðŸ“Š æµ‹è¯•è¦†ç›–èŒƒå›´

### åŠŸèƒ½è¦†ç›–
| åŠŸèƒ½æ¨¡å— | åŒæ­¥æµ‹è¯• | å¼‚æ­¥æµ‹è¯• | åŽ‹åŠ›æµ‹è¯• | ä½¿ç”¨ç¤ºä¾‹ |
|---------|---------|---------|---------|---------|
| æ²™ç®±åˆ›å»º/é”€æ¯ | âœ… | âœ… | âœ… | âœ… |
| æ–‡ä»¶ç³»ç»Ÿæ“ä½œ | âœ… | âœ… | âœ… | âœ… |
| å‘½ä»¤æ‰§è¡Œ | âœ… | âœ… | âœ… | âœ… |
| PTY æ“ä½œ | âœ… | âœ… | âœ… | âœ… |
| é™æ€æ–¹æ³• | âœ… | âœ… | âœ… | âœ… |
| é”™è¯¯å¤„ç† | âœ… | âœ… | âœ… | âœ… |
| æ€§èƒ½ä¼˜åŒ– | âœ… | âœ… | âœ… | âœ… |
| å¹¶å‘å¤„ç† | âœ… | âœ… | âœ… | âœ… |

### æµ‹è¯•åœºæ™¯
- **åŸºç¡€åŠŸèƒ½**ï¼šå•ä¸€æ“ä½œçš„æ­£ç¡®æ€§éªŒè¯
- **æ‰¹é‡æ“ä½œ**ï¼šå¤§é‡æ•°æ®çš„æ‰¹å¤„ç†èƒ½åŠ›
- **å¹¶å‘å¤„ç†**ï¼šå¤šä»»åŠ¡å¹¶è¡Œæ‰§è¡Œ
- **é”™è¯¯æ¢å¤**ï¼šå¼‚å¸¸æƒ…å†µä¸‹çš„ç³»ç»Ÿç¨³å®šæ€§
- **èµ„æºç®¡ç†**ï¼šå†…å­˜å’Œè¿žæŽ¥çš„æœ‰æ•ˆç®¡ç†
- **æ€§èƒ½åŸºå‡†**ï¼šå„ç§æ“ä½œçš„æ€§èƒ½æŒ‡æ ‡

## ðŸš€ å¿«é€Ÿå¼€å§‹

### 1. çŽ¯å¢ƒå‡†å¤‡
ç¡®ä¿ä½ çš„çŽ¯å¢ƒä¸­å·²ç»å®‰è£…äº†å¿…è¦çš„ä¾èµ–ï¼š
```bash
# ç¡®ä¿æ¨¡å—è·¯å¾„æ­£ç¡®
export PYTHONPATH=/home/ubuntu/git_home/scalebox:$PYTHONPATH

# å®‰è£…ä¾èµ–ï¼ˆå¦‚æžœéœ€è¦ï¼‰
pip install -r requirements.txt
```

### 2. è¿è¡Œå•ä¸ªæµ‹è¯•
```bash
# è¿è¡Œå¼‚æ­¥ç»¼åˆæµ‹è¯•
python test_sandbox_async_comprehensive.py

# è¿è¡ŒåŒæ­¥ç»¼åˆæµ‹è¯•
python test_sandbox_sync_comprehensive.py

# è¿è¡ŒåŽ‹åŠ›æµ‹è¯•
python test_sandbox_stress_and_edge_cases.py

# è¿è¡Œä½¿ç”¨ç¤ºä¾‹
python test_sandbox_usage_examples.py
```

### 3. æ‰¹é‡è¿è¡Œæ‰€æœ‰æµ‹è¯•
```bash
# åˆ›å»ºè¿è¡Œè„šæœ¬
cat > run_all_tests.sh << 'EOF'
#!/bin/bash

echo "å¼€å§‹è¿è¡Œæ‰€æœ‰æ²™ç®±æµ‹è¯•..."

echo "=== å¼‚æ­¥ç»¼åˆæµ‹è¯• ==="
python test_sandbox_async_comprehensive.py

echo "=== åŒæ­¥ç»¼åˆæµ‹è¯• ==="
python test_sandbox_sync_comprehensive.py

echo "=== åŽ‹åŠ›æµ‹è¯•å’Œè¾¹ç•Œæ¡ä»¶ ==="
python test_sandbox_stress_and_edge_cases.py

echo "=== ä½¿ç”¨ç¤ºä¾‹å’Œæœ€ä½³å®žè·µ ==="
python test_sandbox_usage_examples.py

echo "æ‰€æœ‰æµ‹è¯•å®Œæˆ!"
EOF

chmod +x run_all_tests.sh
./run_all_tests.sh
```

## ðŸ“ˆ æ€§èƒ½åŸºå‡†

### åŒæ­¥ vs å¼‚æ­¥æ€§èƒ½å¯¹æ¯”

| æ“ä½œç±»åž‹ | åŒæ­¥ç‰ˆæœ¬ | å¼‚æ­¥ç‰ˆæœ¬ | æ€§èƒ½æå‡ |
|---------|---------|---------|---------|
| å•æ–‡ä»¶æ“ä½œ | ~0.1s | ~0.1s | æŒå¹³ |
| æ‰¹é‡æ–‡ä»¶æ“ä½œ(100ä¸ª) | ~2.0s | ~0.5s | **4x æ›´å¿«** |
| å¹¶å‘å‘½ä»¤æ‰§è¡Œ(10ä¸ª) | ~1.5s | ~0.3s | **5x æ›´å¿«** |
| PTY äº¤äº’ä¼šè¯ | ~0.2s | ~0.2s | æŒå¹³ |

### èµ„æºä½¿ç”¨æƒ…å†µ
- **å†…å­˜ä½¿ç”¨**ï¼šå¼‚æ­¥ç‰ˆæœ¬åœ¨å¤§æ‰¹é‡æ“ä½œæ—¶å†…å­˜ä½¿ç”¨æ›´é«˜æ•ˆ
- **CPU åˆ©ç”¨çŽ‡**ï¼šå¼‚æ­¥ç‰ˆæœ¬èƒ½æ›´å¥½åœ°åˆ©ç”¨å¤šæ ¸ CPU
- **ç½‘ç»œè¿žæŽ¥**ï¼šå¼‚æ­¥ç‰ˆæœ¬æ”¯æŒæ›´å¤šå¹¶å‘è¿žæŽ¥

## ðŸ› ï¸ è‡ªå®šä¹‰æµ‹è¯•

### æ·»åŠ æ–°æµ‹è¯•
1. **ç»§æ‰¿æµ‹è¯•åŸºç±»**ï¼š
```python
class YourTestValidator:
    def __init__(self):
        self.test_results = []
        self.failed_tests = []
    
    def log_test_result(self, test_name: str, success: bool, message: str = "", duration: float = 0):
        # å®žçŽ°æµ‹è¯•ç»“æžœè®°å½•
        pass
```

2. **ç¼–å†™æµ‹è¯•æ–¹æ³•**ï¼š
```python
def test_your_feature(self):
    """æµ‹è¯•ä½ çš„åŠŸèƒ½"""
    # æµ‹è¯•é€»è¾‘
    pass

async def test_your_async_feature(self):
    """æµ‹è¯•ä½ çš„å¼‚æ­¥åŠŸèƒ½"""
    # å¼‚æ­¥æµ‹è¯•é€»è¾‘
    pass
```

3. **è¿è¡Œæµ‹è¯•**ï¼š
```python
def run_all_tests(self):
    self.run_test(self.test_your_feature, "Your Feature Test")
```

### é…ç½®æµ‹è¯•å‚æ•°
```python
# åœ¨æµ‹è¯•æ–‡ä»¶é¡¶éƒ¨é…ç½®
TEST_CONFIG = {
    'debug_mode': True,
    'max_concurrent': 10,
    'timeout': 30,
    'large_file_size': 10 * 1024 * 1024,  # 10MB
    'stress_test_iterations': 1000
}
```

## ðŸ› æ•…éšœæŽ’é™¤

### å¸¸è§é—®é¢˜

1. **æ²™ç®±åˆ›å»ºå¤±è´¥**
   - æ£€æŸ¥ç½‘ç»œè¿žæŽ¥
   - éªŒè¯ API å¯†é’¥é…ç½®
   - ç¡®è®¤æœåŠ¡å™¨çŠ¶æ€

2. **æ–‡ä»¶æ“ä½œå¤±è´¥**
   - æ£€æŸ¥æ–‡ä»¶è·¯å¾„æƒé™
   - éªŒè¯ç£ç›˜ç©ºé—´
   - ç¡®è®¤æ–‡ä»¶æ ¼å¼

3. **å‘½ä»¤æ‰§è¡Œè¶…æ—¶**
   - è°ƒæ•´è¶…æ—¶å‚æ•°
   - æ£€æŸ¥å‘½ä»¤è¯­æ³•
   - éªŒè¯çŽ¯å¢ƒå˜é‡

4. **å†…å­˜ä¸è¶³é”™è¯¯**
   - å‡å°‘å¹¶å‘æ•°é‡
   - è°ƒæ•´æ‰¹å¤„ç†å¤§å°
   - å¢žåŠ ç³»ç»Ÿå†…å­˜

### è°ƒè¯•æŠ€å·§

1. **å¯ç”¨è°ƒè¯•æ—¥å¿—**ï¼š
```python
import logging
logging.basicConfig(level=logging.DEBUG)
```

2. **ä½¿ç”¨è°ƒè¯•æ¨¡å¼**ï¼š
```python
sandbox = Sandbox(debug=True)
# æˆ–
sandbox = await AsyncSandbox.create(debug=True)
```

3. **ç›‘æŽ§èµ„æºä½¿ç”¨**ï¼š
```python
import psutil
print(f"å†…å­˜ä½¿ç”¨: {psutil.virtual_memory().percent}%")
print(f"CPU ä½¿ç”¨: {psutil.cpu_percent()}%")
```

## ðŸ“ è´¡çŒ®æŒ‡å—

### æ·»åŠ æ–°æµ‹è¯•
1. Fork é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯
3. æ·»åŠ æµ‹è¯•ç”¨ä¾‹
4. æ›´æ–°æ–‡æ¡£
5. æäº¤ Pull Request

### æµ‹è¯•è§„èŒƒ
- æ¯ä¸ªæµ‹è¯•å‡½æ•°éƒ½åº”è¯¥æœ‰æ¸…æ™°çš„æ–‡æ¡£å­—ç¬¦ä¸²
- ä½¿ç”¨æ–­è¨€éªŒè¯ç»“æžœ
- åŒ…å«é€‚å½“çš„é”™è¯¯å¤„ç†
- è®°å½•æ€§èƒ½æŒ‡æ ‡
- æ¸…ç†æµ‹è¯•èµ„æº

## ðŸ“š å‚è€ƒèµ„æ–™

### API æ–‡æ¡£
- [AsyncSandbox API](../sandbox_async/main.py)
- [Sandbox API](../sandbox_sync/main.py)
- [æ–‡ä»¶ç³»ç»Ÿ API](../sandbox/filesystem/)
- [å‘½ä»¤æ‰§è¡Œ API](../sandbox/commands/)

### æœ€ä½³å®žè·µ
- å§‹ç»ˆä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨ç®¡ç†æ²™ç®±èµ„æº
- æ‰¹é‡æ“ä½œä¼˜äºŽå•ä¸ªæ“ä½œ
- å¼‚æ­¥ç‰ˆæœ¬é€‚åˆ I/O å¯†é›†åž‹ä»»åŠ¡
- åŒæ­¥ç‰ˆæœ¬é€‚åˆ CPU å¯†é›†åž‹ä»»åŠ¡
- å®žçŽ°é€‚å½“çš„é‡è¯•å’Œé”™è¯¯æ¢å¤æœºåˆ¶

---

**Happy Testing! ðŸŽ‰**

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æäº¤ Issue æˆ–è”ç³»ç»´æŠ¤å›¢é˜Ÿã€‚
